name: PR Description Check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]
    branches: [main]

jobs:
  check-pr-description:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR description length
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          # Clean up line endings
          PR_BODY=$(echo "$PR_BODY" | tr -d '\r')
          MIN_LENGTH=50
          
          # Remove markdown formatting and HTML comments for length check
          CLEAN_BODY=$(echo "$PR_BODY" | perl -0777 -pe 's/<!--.*?-->//gs' | sed 's/`//g' | sed 's/\*\*//g' | sed 's/\*//g' | sed 's/###*//g' | sed 's/---*//g')
          
          if [ ${#CLEAN_BODY} -lt $MIN_LENGTH ]; then
            echo "‚ùå PR description is too short (${#CLEAN_BODY} characters). Please provide a detailed description of at least $MIN_LENGTH characters explaining the changes."
            echo "üí° Consider including:"
            echo "  - What changes were made"
            echo "  - Why these changes are needed"
            echo "  - How to test the changes"
            echo "  - Any breaking changes"
            exit 1
          fi
          
          echo "‚úÖ PR description meets minimum requirements (${#CLEAN_BODY} characters)"